#!/usr/bin/env node

'use strict';

var APP_DIR = __dirname + '/../app',
    VIEW_DIR = APP_DIR + '/views',
    SRC = __dirname + '/../src';

var ctx = {
  appDir: APP_DIR,
  viewDir: VIEW_DIR
};

// Usage: templatize <in.js> <out.html>
var path = require('path'),
    fs = require('fs'),
    hljs = require('highlight.js'),
    tmpl = require(SRC + '/tmpl'),
    loc = require(SRC + '/loc'),
    summary = require(SRC + '/summary'),
    inf = process.argv[2],
    outf = process.argv[3];

var code = fs.readFileSync(inf, 'utf8');

fs.writeFileSync(outf, tmpl.view(tmpl.layoutPath('index', ctx), {
  body: tmpl.view(tmpl.viewPath('code', ctx), {
    loc: loc(code),
    bytes: code.length, // NOTE: this is not necessarily byte size (non-ASCII chars)
    path: path.basename(inf),
    code: hljs.highlight('javascript', code).value,
    summary: summary(code)
  })
}));
